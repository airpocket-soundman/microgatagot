# microガタゴッt
microガタゴッtは、microbitを使ってプラレールを自動運転するためのプロジェクトです。  
※画像をクリックするとyoutube動画を再生します。  
[![microガタゴッt](https://github.com/airpocket-soundman/microgatagot/blob/main/image/thumbnail.png)](https://www.youtube.com/watch?v=oYZ8JgSuECc)

# 使い方
送信機のAボタンを押すとトーマスが走り始めます。もう一度押すと止まります。  
トーマスが駅の前の磁石を取り付けた線路の上を通ると自動的に停車し、5秒後に出発します。  
送信機のBボタンを押すとポイントが切り替わります。  
トーマスが遮断器の手前のToFセンサに近づくと自動的に遮断器がおります。4秒後に遮断器が上がります。  

# 部品と工作
使用するmicrobitはV1,V2のどちらでもかまいません。  

## ガタゴット送信機
|部品名|個数|備考|
|-|-|-|
|microbit|1|-|
|[micro:bit用ワークショップモジュール](https://www.switch-science.com/products/5489)|1||

### 工作
特別な工作は必要ありません。ワークショップモジュールにmicrobitを挿して使用します。

## ガタゴットーマス
|部品名|個数|備考|
|-|-|-|
|プラレールの動力車|1||
|プラレールの露天貨物車|1|microbit、モバイルバッテリー、GROVEシールドを載せます|
|microbit|1|-|
|なるべく小さくて軽いモバイルバッテリーなど|1||
|[micro:bit用GROVEシールド v2.0](https://www.switch-science.com/collections/micro-bit/products/5434)|1|-|
|[GROVE - リレー](https://www.switch-science.com/products/807)|1||
|[M5Stack用ホールセンサユニット（A3144E）](https://www.switch-science.com/products/6558)|1||
|適当な被覆導線|20cmくらい|プラレールとリレーの接続に使用します|
|φ1.5×3mm程度のネオジム磁石|4～8個|プラレールの中央の溝の中に配置できてプラレールに当たらない程度の厚みのものです|
### 工作
※はんだとはんだごて、ホットメルト、プラレールを分解するためのドライバー類、六角レンチセット、導線を扱うためのニッパー等が必要です。
#### プラレールのリモコン化
1.プラレールの動力車を分解してスイッチ部品を取り外します。 
2.スイッチ部品を取り外した回路のモーター側と電池側にそれぞれ導線を一本ずつ半田付けします。 
3.半田付けした導線をリレーの緑いろの端子に一本ずつ固定します。 
4.リレーをプラレールの適当な場所にホットメルトで固定します。 
5.リレーとGROVEシールドをGROVEケーブルで接続します。 

#### プラレールの自動停発車機能
1.M5Stack用ホールセンサユニットの筐体を分解して基板を取り出します。 
2.プラレールの貨車車両の底面にホールセンサユニットの基板をホットメルトで固定します。 
※ホールセンサがプラレールに接触しない様気を付けます。 
3.プラレールの中央の溝に任意の数のネオジム磁石をホットメルトで固定します。 
※ネオジム磁石の向きに注意します。ホールセンサが反応する向き、高さに固定します。ホールセンサは一定の時間間隔で磁石を検出します。磁石の数が少ないとホールセンサが検出できない場合があるため、必要な長さになるようにネオジム磁石の数を増やします。 
4.ホールセンサとGROVEシールドでGROVEケーブルで接続します。 

## ポイント
|部品名|個数|備考|
|-|-|-|
|microbit|1||
|[micro:bit用ワークショップモジュール](https://www.switch-science.com/products/5489)|1||
|[GeekServo 9G Servo-Gray](https://www.switch-science.com/products/6811)|1||
|LEGOテクニック|適量||
|LEGOテクニック歯車（大）|1||
|φ1しんちゅう線|10cmくらい||
|段ボール|適量|プラレールのポイント部品とサーボを固定します|

### 工作
1.LEGOテクニックを使ってサーボの固定台を作りサーボを固定します。サーボには歯車大を取り付けます。 
2.プラレールのポイントレールの側面にφ1しんちゅう線が通るくらいの穴をあけます。 
※この穴を通して黄色いポイントパーツを動かすため、ポイントの先端付近の側面に穴を開けます。 
3.ポイントとサーボの配置を決めて、段ボールの上に両面テープなどで固定します。 
4.しんちゅう線を適当な長さに切り、ポイントパーツと歯車大に取り付けてサーボが歯車を回すとポイントが動く様に調整します。 
※歯車やポイントへの取付は、穴を開けてフック上に曲げたしんちゅうをひっかけるなど工夫します。 

## 遮断器
|部品名|個数|備考|
|-|-|-|
|microbit|1||
|[BitMaker V2](https://www.switch-science.com/products/8412)|1||
|LEGOテクニック|適量||
|[M5Stack用ToF測距センサユニット](https://www.switch-science.com/products/5219)|1||
|[GeekServo 9G Servo-Gray](https://www.switch-science.com/products/6811)|2|踏切一つにつき1個必要|
|[QIコネクタキット](https://www.amazon.co.jp/%E3%82%A2%E3%82%A4%E3%82%A6%E3%82%A3%E3%82%B9-IWISS-2-54mm%E3%83%94%E3%83%83%E3%83%81-%E3%83%87%E3%83%A5%E3%83%9D%E3%83%B3%E3%82%B3%E3%83%8D%E3%82%AF%E3%82%BF-IWS-2820/dp/B085GGT4B8)|1セット|GROVEコネクタ⇔QIコネクタの変換ケーブルを作成します|
|(M5Stack用GROVE互換ケーブル 10 cm 5本セット)[https://www.switch-science.com/products/5214]|1セット|このケーブルで変換ケーブルを自作します|

### 工作
工作にはQIコネクタの圧着ペンチや、ニッパー、ケーブルストリッパーなどが必要です。
1.LEGOテクニックを使ってGeekServoを固定して遮断器を作ります。 
2.LEGOテクニックを使ってToFセンサの固定台を作ります。 
3.Groveケーブルの方端をカットしてQIコネクタの3pinコネクタを接続します。GROVEの赤とサーボの赤、黒とサーボの茶色、黄色と黄色が接続できる様にします。 
4.サーボをBitMakerのP0コネクタ、P1コネクタに変換ケーブルで接続します。 
6.ToFセンサをBitMakerのI2C用コネクタに接続します。 
5.段ボールにレール、遮断器、ToFセンサ、BitMkaerを両面テープ等で固定します。 

# プログラム
srcにはトーマス、遮断機、ポイント、送信機それぞれのmicrobitのコードを保存しています。
遮断機制御用microbitは、makecodeでコーディングしています。それ以外の3つのmicrobitはmicrobit python editorでコーディングしています。

|ファイル名|内容|開発環境|
|-|-|-|
|ガタゴット送信機.hex|送信機用|microbit python editor|
|ガタゴットーマス.hex|トーマス制御用|microbit python editor|
|ポイント.hex|ポイント操作用|microbit python editor|
|遮断機.hex|遮断機用|make code|
※遮断器のプログラムには拡張機能のrange-vl53l0xを使用しています。
